<!doctype html>

<html lang="en">

<!--
  Apply head only for dev environment, this is required for jekyll to
  insert livereload scripts
-->

  <head>



  <meta charset="utf-8">


<title>Gaokao Index Spider - Dalvik's Blog</title>

<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<!-- Define a description for better SEO result -->
<meta name="description" content="目录结构 ├── gaokao-index/ (配置文件) | ├── contents/ | | └── line.js (爬取历年分数线、学校简介、收费情况、所属省、热度排名等内容) | | └── constitution.py (爬取各学校招生章程) | | └── schools.py (爬取学校) | └── data/ (保存已爬到的数据文件) | ... └── \_\_main__.py (主要运行文件，修改以调整启用的配置文件) └── index.kyx (用于服务器的可执行程序，本质是 php) └── structure.sql (表结构，实现建立结构后便于日后...">

<!-- Cheome Web App theme color -->
<meta name="theme-color" content="#00ebff">

<!-- Feed URL -->
<link rel="alternate" href="/feed.xml" type="application/atom+xml">

<!-- Site icons -->
<link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="icon" href="/favicon.png" type="image/png"><link rel="icon" href="/favicon.svg?assets-inline-assets-keep" sizes="any" type="image/svg+xml"><link rel="mask-icon" href="/mask-icon.svg" color="#00ebff">

<!-- Chrome Web App manifest -->
<link rel="manifest" href="/manifest.json">

<!-- Main CSS -->
<link rel="stylesheet" href="/assets/themes/curtana/css/app.css?assets-inline">

<!-- Canonical links, avoid duplicate content problems -->
<link rel="canonical" href="http://0.0.0.0:4321/work/gaokao-index/">

<!-- DNS prefetching for static files -->


<!-- Head hooks -->



  </head>

<!-- Open Graph and Twitter Cards support -->
<meta property="og:type" content="article">
<meta property="og:site_name" content="Dalvik's Blog">
<meta property="og:title" content="Gaokao Index Spider">
<meta property="og:url" content="http://0.0.0.0:4321/work/gaokao-index/">
<meta property="og:description" content="目录结构 ├── gaokao-index/ (配置文件) | ├── contents/ | | └── line.js (爬取历年分数线、学校简介、收费情况、所属省、热度排名等内容) | | └── constitution.py (爬取各学校招生章程) | | └── schools.py (爬取学校) | └── data/ (保存已爬到的数据文件) | ... └── \_\_main__.py (主要运行文件，修改以调整启用的配置文件) └── index.kyx (用于服务器的可执行程序，本质是 php) └── structure.sql (表结构，实现建立结构后便于日后...">
<meta property="og:image" content="http://0.0.0.0:4321/logo.png">

<meta name="twitter:card" content="summary_large_image">


  <meta name="twitter:site" content="@tearfulDalvik">



  <meta name="twitter:creator" content="@tearfulDalvik">



  <meta property="article:published_time" content="2018-07-04T00:00:00+08:00">
  <meta property="article:modified_time" content="2019-05-23T21:00:16+08:00">
  <meta name="twitter:label1" value="Words">
  <meta name="twitter:data1" value="212 words">
  <meta name="twitter:label2" value="Reading time">
  <meta name="twitter:data2" value="1 min">

<!-- Post specified styles -->
<style data-assets-inline>
  :root {
    
    --link-color: #ff00b4;
    

    
    --bg-color: #00ebff;
    

    
    --text-color: #0029ff;
    

    
    --code-color: #ad00ff;
    
  }

  body {
    
  }

  
  .content header {
    background: #0029ff;
  }
  
  
  .content header {
    color: #00ebff;
  }
  
    
    .content header a {
      color: #00ebff;
    }
    .content header .external .dot {
      background: #00ebff;
    }
    
</style>
<!-- Main navigation with current page / categoriy highlighted -->
<nav class="navigation">
  <ul>
    <li >
        <a href="/">Dalvik's Blog</a>
      </li>
    <li class=current>
        <a href="/work/">Work</a>
      </li>
    <li >
        <a href="/note/">Note</a>
      </li>
    <li >
        <a href="/about/">About</a>
      </li>
    
  </ul>
</nav>
<!-- Main content wrap -->
<main class="content " role=main>
  <!-- Post-wide custom CSS -->


<!-- Article wrapper, limit width -->
<article lang="en">

  <!-- Post title -->
  <header style="     ">

    <h1 class="" title="Gaokao Index Spider" data-title="Gaokao Index Spider">
      Gaokao Index Spider<span class="dot dot--post"> </span>
    </h1>

    
      <small>
        By <span rel="author">Dalvik Shen</span>
        on <time datetime="2018-07-04T00:00:00+08:00">Jul 4, 2018</time>
      </small>
    

    

  </header>

  <!-- Post content -->
  <div class="post-content">
    <h2 id="目录结构">目录结构</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>├── gaokao-index/ (配置文件)
|   ├── contents/
|   |   └── line.js (爬取历年分数线、学校简介、收费情况、所属省、热度排名等内容)
|   |   └── constitution.py (爬取各学校招生章程)
|   |   └── schools.py (爬取学校)
|   └── data/ (保存已爬到的数据文件)
|   ...
└── \_\_main__.py (主要运行文件，修改以调整启用的配置文件)
└── index.kyx (用于服务器的可执行程序，本质是 php)
└── structure.sql (表结构，实现建立结构后便于日后导入)
</code></pre></div></div>

<h2 id="本地准备">本地准备</h2>

<p>建议环境：macOS 10.13.x</p>

<p>安装 Python3.6（包括 pip36）和 nodejs 8.x.x（包括 npm） ，版本可以有微小的不同，但是不建议跨发行版。并安装 git 工具</p>

<p><code class="highlighter-rouge">brew install pip36 npm git</code></p>

<p>然后安装依赖并克隆仓库</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/tearfulDalvik/gaokao-index.git
<span class="nv">$ </span><span class="nb">cd </span>gaokao-index
<span class="nv">$ </span>pip36 <span class="nb">install </span>lxml
<span class="nv">$ </span>npm <span class="nb">install</span>
</code></pre></div></div>

<h2 id="服务器准备">服务器准备</h2>

<p>建议环境：php7.x 和 mariadb 10.1.x</p>

<p><code class="highlighter-rouge">yum install php72w mariadb -y</code></p>

<p>将 index.kyx 上传到网站中，如果不会配置请直接将后缀名改为 php。</p>

<p>自行新建数据库后导入结构</p>

<p><code class="highlighter-rouge">mysql -uroot -p 数据库名 &lt; structure.sql</code></p>

<p>然后编辑 index.kyx 文件并填写数据库名称、服务器地址、用户名和密码等信息。</p>

<h2 id="schoolspy">schools.py</h2>

<p>高考一年一度，因此很有可能系统已经不一样，但是可以借鉴本爬虫的相关思路。</p>

<ol>
  <li>在招考系统中按下 Command + Option + I ，选中 Network 选项卡，点击 “浏览院校计划”</li>
  <li>在记录下来的请求中找到 jsp 可执行文件后缀的请求，并在 Preview 中查看是否是没有 css 样式的表格</li>
  <li>从该请求中提取 ACCESS TOKEN 、分类的代码（理工或文史）和分页的依据</li>
  <li>复制到 schools.py 中，将第几页替换成 %s 表示</li>
  <li>如果想增加栏目，自行 Google 爬虫的 Xpath 用法和获取</li>
</ol>

<p>运行即可在 data 目录中获取 schools.sql，上传到服务器后导入（接下来的导入以此类推）</p>

<p><code class="highlighter-rouge">mysql -uroot -p 数据库名 &lt; schools.sql</code></p>

<p><strong>我不打算再介绍 constitution.py 的用法， 阳光平台每年的变化不大，几乎直接运行即可。即使不能，我留下了 url 在里面，你可以自行分析。</strong></p>

<h2 id="linejs">line.js</h2>

<p>这里使用了 nodejs 是因为这些页面是动态加载的，从网页中获得的源代码是 Javascript ，因此将计就计使用 js 来编写。</p>

<p>line.js 本质即为一个 REST API 请求模拟器，一般来说变化不大可以直接运行：</p>

<p><code class="highlighter-rouge">npm run line</code></p>

<p>但是一旦出现错误，你需要自行研究其接口并将结果复制到 line.js 中。</p>

<p>导入即可。</p>

<h2 id="license">License</h2>

<p>Copyright © 2018 <a href="https://ifengge.cn/">Dalvik Shen</a></p>

<p>Open source under <a href="http://www.gnu.org/licenses/gpl-3.0.html">GNU General Public License v3.0</a> license</p>

<p>本项目已经提交到 Github：<a href="https://github.com/tearfulDalvik/gaokao-index/">传送门</a></p>


    
    

    
  </div>

</article>

</main>
<!-- Footer section -->

  <footer class="footer">
    <ul>
      <li><a href="/">Dalvik's Blog</a></li>

      
        <li>
          <a href="https://sparanoid.com/lab/amsf/" title="Almace Scaffolding with theme Curtana">AMSF</a>
        </li>
      

      
    </ul>
  </footer>


<!-- Theme scripts -->
<script src="/assets/themes/curtana/js/app.js?assets-inline"></script>

<!-- User scripts -->
<script src="/assets/js/user.js?assets-inline"></script>

<!-- Lightense Images -->

  <script src="/assets/themes/curtana/js/lightense.min.js?assets-inline"></script>
  <script>
    window.addEventListener('load', function () {
      Lightense('p > img:not(.no-lightense),.lightense');
    }, false);
  </script>


<!-- Service Worker  -->


<!-- Google Analytics -->
<script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-131388356-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js"></script>

<!-- Foot hooks -->


<!-- Finale -->
</html>
